<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-BR" lang="pt-BR"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

<h:head>
    <title>Novo Livor</title>
</h:head>

<h:body>
    <h1>Novo Livro</h1>
    <h:form>
        <h:messages id="messages"/>
        <fieldset>
            <legend>Dados do livro</legend>
            <h:panelGrid columns="2">
                <h:outputLabel for="titulo" value="Titulo:"/>
                <h:inputText id="titulo" value="#{livroBean.livro.titulo}" required="true" requiredMessage="Titulo obrigatório" validatorMessage="Título não pode ser superior a 50 caracteres">
                    <f:validateLength maximum="50"/>
                    <f:ajax event="blur" render="messages"/>
                </h:inputText>
                <h:outputLabel for="isbn" value="ISBN:"/>
                <h:inputText id="isbn" value="#{livroBean.livro.isbn}" validator="#{livroBean.comecaComDigitoUm}">
                    <f:ajax event="keyup" render="messages"/>
                </h:inputText>
                <h:outputLabel for="preco" value="Preço:" />
                <h:inputText id="preco" value="#{livroBean.livro.price}" required="true" requiredMessage="Informe um valor de preço valido" validatorMessage="O preço de deve ser maior que R$ 1 e Menor que R$ 1000">
                    <f:validateDoubleRange minimum="1.0" maximum="1000.00"/>
                    <f:ajax event="blur" render="messages"/>
                </h:inputText>
                <h:outputLabel for="data" value="Data de Lançamento:"/>
                <h:inputText id="data" value="#{livroBean.livro.dataLancamento.time}" rendered="true" requiredMessage="Data invalida dd/mm/yyyy HH:mm">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo"/>
                </h:inputText>
            </h:panelGrid>
        </fieldset>
        <fieldset>
            <legend>Dados do autor</legend>
            <h:outputLabel value="Selecione Autor:" for="autor"/>
            <h:selectOneMenu id="autor"  value="${livroBean.autorId}">
                <f:selectItems value="#{livroBean.autores}"
                               var="autor" itemLabel="#{autor.name}"
                               itemValue="#{autor.id}" />
            </h:selectOneMenu>
            <h:commandButton value="Adicionar autor" action="#{livroBean.setAutor}">
                <f:ajax execute="autor" render="tabelaAutores"/>
            </h:commandButton>
            <h2>Autores do Livro</h2>
            <h:dataTable id="tabelaAutores" value="#{livroBean.autoresDoLivro}" var="autor">
                <h:column>
                    <h:outputText value="#{autor.name}"/>
                </h:column>
            </h:dataTable>
        </fieldset>
            <h:commandButton value="Gravar" action="#{livroBean.save}">
                <f:ajax execute="@form" render="@form :tabelaLivros"/>
            </h:commandButton>
    </h:form>

    <hr/>
    <h:dataTable value="#{livroBean.allLivros}" var="livro" id="tabelaLivros">
        <h:column>
            <f:facet name="header">Título</f:facet>
            <h:outputText value="#{livro.titulo}"/>
        </h:column>
        <h:column>
            <f:facet name="header">ISBN</f:facet>
            <h:outputText value="#{livro.isbn}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Preço</f:facet>
            <h:outputText value="#{livro.price}">
                <f:convertNumber type="currency" pattern="R$ #0.00" currencySymbol="R$" locale="pt_BR" />
            </h:outputText>
        </h:column>
        <h:column>
            <f:facet name="header">Data de lançamento</f:facet>
            <h:outputText value="#{livro.dataLancamento.time}">
                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo"/>
            </h:outputText>
        </h:column>
    </h:dataTable>
</h:body>

</html>